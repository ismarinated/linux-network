<h2>Part 1. Инструмент ipcalc</h2>

<h3>1.1. Сети и маски</h3>

1. Адрес сети 192.167.38.54/13 найден командой `ipcalc 192.167.38.54/13 | grep Network`

![Task One](images/task_1_1.png)

2. Перевод маски 255.255.255.0 в префиксную и двоичную запись, /15 в обычную и двоичную, 11111111.11111111.11111111.11110000 в обычную и префиксную

    - Перевод маски 255.255.255.0 выполнен командой `ipcalc 255.255.255.0 | grep -e Netmask`

    - Префиксная запись: `/24`
    - Двоичная запись: `11111111.11111111.11111111.00000000`

    ![Task One](images/task_1_2.png)

    - Перевод маски /15 выполнен командой `ipcalc 0.0.0.0 /15 | grep -e Netmask`

    - Префиксная запись: `/15`
    - Двоичная запись: `11111111.11111110.00000000.00000000`

    ![Task One](images/task_1_3.png)

    - Перевод маски 11111111.11111111.11111111.1111.0000 выполнен командой `ipcalc 11111111.11111111.11111111.1111.0000 /28 | grep -e Netmask`

    - Префиксная запись: `/28`
    - Обычная запись: `255.255.240.0`

    ![Task One](images/task_1_4.png)

3. Минимальный и максимальный хост в сети 12.167.38.4 при масках: /8, 11111111.11111111.00000000.00000000, 255.255.254.0 и /4

    - Минимальный и максимальный хост в сети 12.167.38.4 для 4 масок найдены с помощью команд `ipcalc 12.167.38.4/8 | grep -e HostMin -e HostMax`, `ipcalc 12.167.38.4/16 | grep -e HostMin -e HostMax`, `ipcalc 12.167.38.4 255.255.254.0 | grep -e HostMin -e HostMax` и `ipcalc 12.167.38.4/4 | grep -e HostMin -e HostMax` соответственно. Искомые параметры отображены на рисунке

    ![Task One](images/task_1_5.png)

<h3>1.2. localhost</h3>

- Так как localhost присвоено IP-адресу 127.0.0.1, можно сделать вывод, что обратится к приложению по адресу:

    - 194.34.23.100 - нельзя
    - 127.0.0.2 - можно
    - 127.1.0.1 - можно
    - 128.0.0.1 - нельзя

<h3>1.3. Диапазоны и сегменты сетей</h3>

- Часные IP-адреса (попадают в частные диапазоны)

    - 10.0.0.45
    - 192.168.4.2
    - 172.20.250.4
    - 172.16.255.255
    - 10.10.10.10

- Публичные IP-адреса (не попадают в частные диапазоны)

    - 134.43.0.2
    - 172.0.2.1
    - 192.172.0.1
    - 172.68.0.2
    - 192.169.168.1

- У сети 10.10.0.0/18 возможны адреса:

    - 10.0.0.1 - невозможен
    - 10.10.0.2 - возможен
    - 10.10.10.10 - возможен
    - 10.10.100.1 - невозможен
    - 10.10.1.255 - возможен

---

<h2>Part 2. Статическая маршрутизация между двумя машинами</h2>

- Существующие сетевые интерфейсы, отображенные с помощью команды `ip a` для виртуальных машин `ws1` и `ws1` показаны на рисунке

![Task Two](images/task_2_1.png)

- Содержимое измененных конфигурационных файлов etc/netplan/00-installer-config.yaml для двух устройств показано на рисунке

![Task Two](images/task_2_2.png)

- Вызов и вывод при использовании команды `netplan apply`

![Task Two](images/task_2_3.png)

<h3>2.1. Добавление статического маршрута вручную</h3>

- Статические адреса добавлены вручную с помощью команды `sudo ip addr add`, после чего были пропингованы

![Task Two](images/task_2_4.png)

<h3>2.2. Добавление статического маршрута с сохранением</h3>

- Добавление статических маршрутов выполнено через конфигурационный файл. Содержание измененного файла показано на рисунке

![Task Two](images/task_2_5.png)

- После применения команды `sudo netplan apply` соединение между устройствами было пропинговано

![Task Two](images/task_2_5.png)
---

<h2>Part 3. Утилита iperf3</h2>

<h3>3.1. Скорость соединения</h3>

- 8 Mbps = 1 MB/s
- 100 MB/s = 800000 Kbps
- 1 Gbps = 1000 Mbps

<h3>Утилита iperf3</h3>

- Выполнен запуск утилиты `iperf3` на ws1 командой `iperf3 -s`

![Task Three](images/task_3_1.png)

- Затем на устройстве ws2 выполнена команда `iperf3 -c 192.168.100.10`

![Task Three](images/task_3_2.png)
---

<h2>Part 4. Сетевой экран</h2>

<h3>4.1. Утилита iptables</h3>

- Содержание файла для ws1

![Task Four](images/task_4_1.png)

- Содержание файла для ws2

![Task Four](images/task_4_2.png)

- Добавление свойства исполнимости с помощью утилиты `chmod` и запуск файла для ws1

![Task Four](images/task_4_3.png)

- Добавление свойства исполнимости с помощью утилиты `chmod` и запуск файла для ws2

![Task Four](images/task_4_4.png)

- Разница в стратегии между файлами заключается в последовательности команд. Утилита `iptables` выполняет первое прочитанное правило, на WS1 будет выполнятся `REJECT` и `ping` не пройдет, а на WS2 наоборот, первым стоит `ACCEPT`, разрешить прохождение пакета, `ping` пройдет.

<h3>4.2. Утилита nmap</h3>

- Ввиду правила из предыдущего задания, ws1 не пингуется. Утилита `nmap` показывает, что хост устройства запущен

![Task Four](images/task_4_5.png)
---

<h2>Part 5. Статическая маршрутизация сети</h2>

<h3>5.1. Настройка адресов машин</h3>

- Настройка конфигурации ws11

![Task Five](images/task_5_1.png)

- Вывод команды `ip -4 a` для ws11

![Task Five](images/task_5_2.png)

- Настройка конфигурации ws21

![Task Five](images/task_5_3.png)

- Вывод команды `ip -4 a` для ws21

![Task Five](images/task_5_4.png)

- Настройка конфигурации ws22

![Task Five](images/task_5_5.png)

- Вывод команды `ip -4 a` для ws22

![Task Five](images/task_5_6.png)

- Настройка конфигурации r1

![Task Five](images/task_5_7.png)

- Вывод команды `ip -4 a` для r1

![Task Five](images/task_5_8.png)

- Настройка конфигурации wsr2

![Task Five](images/task_5_9.png)

- Вывод команды `ip -4 a` для r2

![Task Five](images/task_5_10.png)

- Пинг ws22 с ws21 выполнен командой `ping -c 4 10.20.0.20`

![Task Five](images/task_5_11.png)

- Пинг r1 с ws11 выполнен командой `ping -c 4 10.10.0.1`

![Task Five](images/task_5_12.png)

<t3>5.2. Включение переадресации IP-адресов</t3>

- Применение команды `sysctl -w net.ipv4.ip_forward=1` на роутере r1

![Task Five](images/task_5_13.png)

- Применение команды `sysctl -w net.ipv4.ip_forward=1` на роутере r2

![Task Five](images/task_5_14.png)

- Добавление строки `net.ipv4.ip_forward = 1` на r1

![Task Five](images/task_5_15.png)

- Добавление строки `net.ipv4.ip_forward = 1` на r2

![Task Five](images/task_5_16.png)

<t3>5.3. Установка маршрута по умолчанию</t3>

- Настройка шлюза для ws11

![Task Five](images/task_5_17.png)

- Вывод таблицы маршрутизации для ws11

![Task Five](images/task_5_18.png)

- Настройка шлюза для ws21

![Task Five](images/task_5_19.png)

- Вывод таблицы маршрутизации для ws21

![Task Five](images/task_5_20.png)

- Настройка шлюза для ws22

![Task Five](images/task_5_21.png)

- Вывод таблицы маршрутизации для ws22

![Task Five](images/task_5_22.png)

- Пинг с ws11 роутера r2

![Task Five](images/task_5_23.png)

- Вывод команды `tcpdump -tn -i enp0s8`, вызванной на r2

![Task Five](images/task_5_24.png)

<t3>5.4. Добавление статических маршрутов</t3>

- Добавление статических маршрутов на r1

![Task Five](images/task_5_25.png)

- Таблица маршрутизации для r1

![Task Five](images/task_5_26.png)

- Добавление статических маршрутов на r2

![Task Five](images/task_5_27.png)

- Таблица маршрутизации для r2

![Task Five](images/task_5_28.png)

- Выполнение команд `ip r list 10.10.0.0/18` и `ip r list 0.0.0.0/0`

![Task Five](images/task_5_29.png)

- Для адреса 10.10.0.0/18 был выбран маршрут, отличный от 0.0.0.0/0, потому что при наличии двух и более маршрутов выбирается маршрут с самой длинной маской, так как он более точный

<h3>5.5. Построение списка маршрутизаторов</h3>

- Запуск `traceroute 10.20.0.10` на ws11 для построение списка маршрутизаторов по пути до ws21

![Task Five](images/task_5_30.png)

- Запуск команды `tcpdump -tnv -i enp0s8 arp` для отображения перехвата трафика по протоколу определения адреса arp

![Task Five](images/task_5_30.png)

- `traceroute` определяет маршрут пакетов до конечного устройства, измеряя время прохождения через каждый промежуточный узел. Он отправляет пакеты с увеличением значения Time-to-Live (TTL) начиная с 1. Каждый маршрутизатор, уменьшая TTL, отправляет ICMP-сообщение "Time Exceeded" при достижении нуля, что позволяет определить его IP-адрес и время отклика. Увеличивая TTL на единицу, traceroute последовательно фиксирует все промежуточные узлы, пока пакет не достигнет нужного адреса или не будет заблокирован

<h3>5.6. Использование протокола ICMP при маршрутизации</h3>

- Пингование несуществующего адреса с ws11 командой `ping -c 1 10.30.0.111`

![Task Five](images/task_5_32.png)

- Запуск перезвата сетевого трафика, проходящего через enp0s8, на роутере r1 `tcpdump -n -i enp0s8 icmp`

![Task Five](images/task_5_33.png)
---

<h2>Part 6. Динамическая настройка IP с помощью DHCP</h2>

1. Указание адреса маршрутизатора по умолчанию, DNS-сервера и адреса внутренней сети для r2 показано на рисунке

    ![Task Six](images/task_6_1.png)

2. Указание `nameserver 8.8.8.8` в файле  /etc/resolv.conf

    ![Task Six](images/task_6_2.png)

    - Перезапуск службы DHCP командой `systemctl restart isc-dhcp-server`

    ![Task Six](images/task_6_3.png)

    - Измененный конфигурационный файл для ws21 с измененным параметром dhcp4 и закомментированными статическими настройками

    ![Task Six](images/task_6_6.png)

    - Вывод `ip a` на устройстве ws21. Адрес был получен

    ![Task Six](images/task_6_4.png)

    - Пингование ws22 с ws21

    ![Task Six](images/task_6_5.png)

    - Указание MAC-адреса и параметра dhcp4 в конфигурационном файле etc/netplan/00-installer-config.yaml на ws11

    ![Task Six](images/task_6_7.png)

    - Изменение MAc-адреса в настройках устройства

    ![Task Six](images/task_6_8.png)

    - Настройка dhcpd.conf на r1

    ![Task Six](images/task_6_9.png)

    - ws11 `ip a` после перезапуска службы DHCP

    ![Task Six](images/task_6_10.png)

    - ws21 `ip a` до обновления IP-адреса

    ![Task Six](images/task_6_11.png)

    - Обновление IP-адреса ws21 командой `sudo dhclient enp0s8` и новый вывод `ip a`

    ![Task Six](images/task_6_12.png)

- При выполнении заданий части 6 были использованы опции DHCP:
    
    - option routers ip-address - адрес шлюза для сети клиента

    - option domain-name-server ip-address - список DNS серверов, доступных клиенту
---

<h2>Part 7. NAT</h2>

- На устройствах ws22 и r1 в конфигурационном файле /etc/apache2/ports.conf заменяем строку для изменения доступности сервера Apache2

![Task Seven](images/task_7_1.png)

- Веб-сервер Apache запущен на тех же устройствах командой `service apache2 start`

![Task Seven](images/task_7_2.png)

- Добавление фаервола на r2 через файл /etc/firewall.sh

![Task Seven](images/task_7_3.png)

- Предание файлу свойства исполнимости и его запуск

![Task Seven](images/task_7_4.png)

- Проверка соединения ws22 и r1 через пингование

![Task Seven](images/task_7_5.png)

- Изменение файла с фаерволом на r2 добавлением разрешения маршрутизации всех пакетов протокола ICMP

![Task Seven](images/task_7_6.png)

- Повторная проверка соединения ws22 и r1 через пингование

![Task Seven](images/task_7_7.png)

- Изменение файла с фаерволом на r2 добавлением включения SNAT, DNAT и разрешенразрешенияием на прослушку TCP

![Task Seven](images/task_7_8.png)

- Подключение к серверу Apache на r1 с ws22

![Task Seven](images/task_7_9.png)

- Подключение к серверу Apache на ws22 с r1

![Task Seven](images/task_7_9.png)